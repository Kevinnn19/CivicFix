@model IEnumerable<CivicFix.Models.Complaint>
@{
    ViewData["Title"] = "Technician Dashboard";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>My Assigned Complaints</h2>
    <div>
        <span class="text-muted">Welcome, @User.FindFirstValue(ClaimTypes.Name)</span>
        <a href="/Technician/AvailableWork" class="btn btn-outline-info ms-2">Available Work</a>
        <a href="/Technician/Scoreboard" class="btn btn-outline-success ms-2">Scoreboard</a>
        <a href="/Account/Logout" class="btn btn-outline-danger ms-2">Logout</a>
    </div>
</div>

<!-- Statistics Cards -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-bg-primary">
            <div class="card-body text-center">
                <h5 class="card-title">@ViewBag.Stats.TotalAssigned</h5>
                <p class="card-text small">Total Assigned</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-bg-warning">
            <div class="card-body text-center">
                <h5 class="card-title">@ViewBag.Stats.Pending</h5>
                <p class="card-text small">Pending</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-bg-info">
            <div class="card-body text-center">
                <h5 class="card-title">@ViewBag.Stats.InProgress</h5>
                <p class="card-text small">In Progress</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-bg-success">
            <div class="card-body text-center">
                <h5 class="card-title">@ViewBag.Stats.Fixed</h5>
                <p class="card-text small">Fixed</p>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Complaint ID</th>
                        <th>Problem Type</th>
                        <th>Description</th>
                        <th>Status</th>
                        <th>Assigned Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var complaint in Model)
                    {
                        <tr>
                            <td>#@complaint.ComplaintId</td>
                            <td>@complaint.ProblemType</td>
                            <td>@(complaint.Description?.Length > 50 ? complaint.Description.Substring(0, 50) + "..." : complaint.Description)</td>
                            <td>
                                <span class="badge status-badge @(complaint.Status.ToString().ToLower())">@complaint.Status</span>
                            </td>
                            <td>@complaint.CreatedAt.ToLocalTime().ToString("MMM dd, yyyy")</td>
                            <td>
                                <a href="@Url.Action("Details", new { id = complaint.ComplaintId })" class="btn btn-sm btn-outline-primary">
                                    View Details
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
.status-badge {
    font-size: 0.8em;
}

.status-badge.pending {
    background-color: #ffc107;
    color: #000;
}

.status-badge.inprogress {
    background-color: #17a2b8;
    color: #fff;
}

.status-badge.fixed {
    background-color: #28a745;
    color: #fff;
}
</style>